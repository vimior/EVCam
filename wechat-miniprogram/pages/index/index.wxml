<!--pages/index/index.wxml-->
<view class="container">
  <!-- æœªç»‘å®šè®¾å¤‡ -->
  <view class="card" wx:if="{{!boundDevice}}">
    <view class="empty-state">
      <view class="empty-icon-wrapper">
        <text class="empty-icon-text">ğŸš—</text>
      </view>
      <view class="empty-title">å°šæœªç»‘å®šè®¾å¤‡</view>
      <view class="empty-desc">æ‰«æè½¦æœºä¸Šçš„äºŒç»´ç ç»‘å®šæ‚¨çš„ EVCam è¡Œè½¦è®°å½•ä»ª</view>
      <button class="btn-primary scan-btn" bindtap="goToScan">æ‰«ç ç»‘å®šè®¾å¤‡</button>
    </view>
  </view>

  <!-- å·²ç»‘å®šè®¾å¤‡ -->
  <view wx:if="{{boundDevice}}">
    <!-- è®¾å¤‡ä¿¡æ¯å¡ç‰‡ -->
    <view class="card device-card">
      <view class="device-header">
        <view class="device-icon">
          <text class="device-icon-text">ğŸ“¹</text>
        </view>
        <view class="device-info">
          <view class="device-name">{{boundDevice.deviceName || 'EVCam è®¾å¤‡'}}</view>
          <view class="device-id text-small">ID: {{boundDevice.deviceId}}</view>
        </view>
        <view class="device-status {{deviceOnline ? 'status-online' : 'status-offline'}}" bindtap="refreshDeviceStatus">
          <view class="status-dot"></view>
          <text>{{deviceOnline ? 'åœ¨çº¿' : 'ç¦»çº¿'}}</text>
        </view>
      </view>

      <view class="device-actions" wx:if="{{deviceOnline}}">
        <view class="action-item" bindtap="goToPreview">
          <text class="action-icon">ğŸ“¹</text>
          <text>å®æ—¶é¢„è§ˆ</text>
        </view>
        <view class="action-item" bindtap="goToControl">
          <text class="action-icon">ğŸ®</text>
          <text>è¿œç¨‹æ§åˆ¶</text>
        </view>
        <view class="action-item" bindtap="goToFiles">
          <text class="action-icon">ğŸ“</text>
          <text>æŸ¥çœ‹æ–‡ä»¶</text>
        </view>
      </view>

      <view class="offline-tip" wx:if="{{!deviceOnline && !loading}}">
        <text>è®¾å¤‡ç¦»çº¿ï¼Œè¯·æ£€æŸ¥è½¦æœºæ˜¯å¦å¼€æœºå¹¶è¿æ¥ç½‘ç»œ</text>
        <text class="debug-info" wx:if="{{lastHeartbeatInfo}}">ï¼ˆ{{lastHeartbeatInfo}}ï¼‰</text>
        <button class="refresh-small-btn" bindtap="refreshDeviceStatus">ç‚¹å‡»åˆ·æ–°</button>
      </view>

      <view class="loading-tip" wx:if="{{loading}}">
        <view class="mini-spinner"></view>
        <text>æ­£åœ¨è·å–è®¾å¤‡çŠ¶æ€...</text>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œå¡ç‰‡ -->
    <view class="card" wx:if="{{deviceOnline}}">
      <view class="card-title">å¿«æ·æ“ä½œ</view>
      <view class="quick-actions">
        <button class="quick-btn record-btn {{commandPending ? 'disabled' : ''}}" bindtap="quickRecord" disabled="{{commandPending}}">
          <text class="quick-icon">ğŸ¬</text>
          <text>ä¸€é”®å½•åƒ</text>
          <text class="quick-desc">60ç§’</text>
        </button>
        <button class="quick-btn photo-btn {{commandPending ? 'disabled' : ''}}" bindtap="quickPhoto" disabled="{{commandPending}}">
          <text class="quick-icon">ğŸ“·</text>
          <text>ä¸€é”®æ‹ç…§</text>
          <text class="quick-desc">ç«‹å³æ‹</text>
        </button>
      </view>
      
      <!-- å‘½ä»¤çŠ¶æ€æç¤º -->
      <view class="command-status-bar" wx:if="{{commandStatus}}">
        <text class="status-icon">{{commandStatus === 'pending' ? 'â³' : commandStatus === 'completed' ? 'âœ…' : 'âŒ'}}</text>
        <text class="status-text">{{commandMessage}}</text>
      </view>
    </view>

    <!-- è§£ç»‘æŒ‰é’® -->
    <view class="unbind-section">
      <button class="btn-secondary unbind-btn" bindtap="unbindDevice">è§£ç»‘è®¾å¤‡</button>
    </view>
  </view>
</view>
